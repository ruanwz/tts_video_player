# TTS字幕视频播放器

一个支持TTS（文字转语音）功能的视频播放器，可以将字幕内容朗读出来，并支持在原声和TTS模式之间切换。

## 功能特点

- 📹 **标准视频播放**：支持所有HTML5支持的视频格式（MP4、WebM等）
- 📝 **多格式字幕**：支持SRT和VTT字幕格式的自动识别和加载
- 🔊 **TTS朗读**：使用macOS系统TTS引擎朗读字幕内容
- 🔄 **模式切换**：一键切换原声和TTS模式
- ⚙️ **自定义设置**：
  - 选择不同的TTS语音
  - 手动调整朗读语速（0.5x - 2.0x）
  - 🎯 **智能语速调整**：根据字幕长度和显示时间自动计算最佳语速
- 🎨 **现代化界面**：响应式设计，支持移动端和桌面端

## 系统要求

- **操作系统**：macOS（其他系统也支持，但TTS效果可能不同）
- **浏览器**：Safari 14+ 或 Chrome 70+（需要支持Web Speech API）

## 使用方法

### 1. 启动播放器

直接在浏览器中打开 `index.html` 文件：

```bash
# 在macOS上
open index.html

# 或者使用本地服务器（推荐）
python3 -m http.server 8000
# 然后访问 http://localhost:8000
```

### 2. 加载内容

1. **上传视频文件**：点击"选择视频文件"按钮，选择你的视频文件
2. **上传字幕文件**：点击"选择字幕文件"按钮，选择SRT或VTT格式的字幕文件
   - 支持格式：`.srt`、`.vtt`
   - 系统会自动检测字幕格式

### 3. 播放控制

- 使用视频播放器的标准控件控制播放、暂停、进度等
- 字幕会自动同步显示在视频下方

### 4. 切换模式

点击**切换按钮**在两种模式之间切换：

- **原声模式**（默认）：播放视频原始音频
- **TTS模式**：静音原始音频，使用TTS朗读字幕

### 5. TTS设置

在TTS控制面板中可以：
- **选择语音**：选择不同的系统语音（优先显示中文语音）
- **语速模式**：
  - **手动模式**（默认）：使用滑块手动调整朗读速度（0.5x - 2.0x）
  - **自动模式**：开启"自动调整语速"开关，系统会根据每条字幕的长度和显示时间智能计算最佳语速
    - 字幕内容多但时间短 → 自动加快语速（最高2.5x）
    - 字幕内容少但时间长 → 保持正常或稍慢语速（最低0.7x）
    - 接近正常语速时自动使用1.0x保持自然
    - 按F12打开控制台可查看详细计算过程

## 字幕文件格式

播放器支持以下字幕格式，系统会自动识别：

### SRT格式

标准的SubRip字幕格式：

```srt
1
00:00:01,000 --> 00:00:04,000
这是第一句字幕

2
00:00:04,500 --> 00:00:08,000
这是第二句字幕
```

**格式说明：**
- 第一行：序号
- 第二行：时间轴（HH:MM:SS,mmm --> HH:MM:SS,mmm）
- 第三行及以后：字幕文本
- 空行分隔不同的字幕块

### VTT格式

WebVTT (Web Video Text Tracks) 格式：

```vtt
WEBVTT

00:00:01.000 --> 00:00:04.000
这是第一句字幕

00:00:04.500 --> 00:00:08.000
这是第二句字幕
```

**格式说明：**
- 第一行必须是 `WEBVTT`
- 时间轴格式：HH:MM:SS.mmm --> HH:MM:SS.mmm（使用小数点而非逗号）
- 支持多行字幕文本
- 自动过滤VTT样式标签（如 `<v Name>`）

### 格式自动检测

播放器会通过以下方式自动检测格式：
1. 文件扩展名（.srt 或 .vtt）
2. 文件内容（VTT文件以"WEBVTT"开头）
3. 时间戳格式（逗号 vs 小数点）

无论使用哪种格式，都能正常工作，建议使用UTF-8编码以支持中文等多语言字符。

## 技术实现

- **前端框架**：原生JavaScript（无需额外依赖）
- **视频播放**：HTML5 Video API
- **TTS引擎**：Web Speech API (SpeechSynthesis)
- **样式**：CSS3，响应式设计

## 工作原理

1. **视频播放**：使用HTML5 `<video>` 元素播放视频
2. **字幕解析**：
   - 自动检测字幕格式（SRT或VTT）
   - 使用正则表达式解析时间轴和文本
   - 统一转换为内部字幕对象数组
3. **字幕同步**：监听视频的 `timeupdate` 事件，根据当前时间显示对应字幕
4. **TTS朗读**：
   - 在TTS模式下，当新字幕出现时触发TTS朗读
   - 使用 `SpeechSynthesisUtterance` API创建朗读任务
   - 视频原声被静音，只播放TTS音频
5. **智能语速调整**：
   - 分析字幕文本，统计中文字符、英文单词和标点符号
   - 计算字幕显示时长（结束时间 - 开始时间）
   - 基于"TTS正常语速约每秒3个中文字"的基准，动态计算最佳语速
   - 自动限制语速范围在0.7x-2.5x，提供广泛的调整空间
   - 接近标准语速(0.85x-1.15x)时自动归一化为1.0，保持自然
   - 实时显示当前使用的语速（绿色表示自动调整）
   - 浏览器控制台输出详细计算过程，方便调试
6. **模式切换**：
   - 原声模式：`video.muted = false`，停止TTS
   - TTS模式：`video.muted = true`，启动TTS朗读

## 浏览器兼容性

| 浏览器 | 支持情况 | 说明 |
|--------|---------|------|
| Safari (macOS) | ✅ 完全支持 | 推荐使用，TTS音质最佳 |
| Chrome (macOS) | ✅ 完全支持 | 支持良好 |
| Firefox | ⚠️ 部分支持 | Web Speech API支持有限 |
| Edge | ✅ 支持 | Windows系统TTS |

## 常见问题

### Q: 为什么听不到TTS声音？

A: 请检查：
1. 是否已切换到TTS模式（按钮显示"当前: TTS字幕"）
2. 系统音量是否打开
3. 浏览器是否支持Web Speech API
4. 字幕文件是否正确加载

### Q: TTS语音列表为空？

A:
- 某些浏览器需要等待片刻让语音列表加载
- 尝试刷新页面
- 确认使用支持的浏览器（Safari或Chrome）

### Q: 字幕显示不正确？

A:
- 确保字幕文件是标准的SRT或VTT格式
- 检查文件编码是否为UTF-8
- VTT文件必须以"WEBVTT"开头
- 时间轴格式要正确（SRT使用逗号，VTT使用小数点）

### Q: 可以同时播放原声和TTS吗？

A: 目前不支持，这是设计上的选择。如需此功能可以修改代码去掉静音逻辑。

### Q: 自动语速模式下语速变化太大怎么办？

A:
- 自动语速会根据每条字幕的长度和时间动态调整，这是正常现象
- 如果觉得变化太频繁，可以关闭自动模式，使用手动语速
- 自动语速范围限制在0.7x-2.5x之间，确保不会太快或太慢
- 对于时长适中的字幕(0.85x-1.15x)，系统会自动归一化为1.0倍速保持自然
- 按F12打开控制台可以看到每条字幕的详细语速计算过程

## 未来改进

- [x] ~~支持更多字幕格式（VTT、ASS等）~~ - **已完成VTT和SRT支持**
- [ ] 支持更多字幕格式（ASS、SSA等）
- [ ] 支持字幕编辑和时间轴调整
- [ ] 添加字幕延迟调整功能
- [ ] 支持导出TTS音频文件
- [ ] 添加键盘快捷键
- [ ] 自动语速的更多自定义选项（最小/最大语速限制）
- [ ] Electron打包为独立应用

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request！

---

**享受你的观影体验！** 🎬🔊
